var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r["throw"](e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})};var __generator=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return u([e,t])}}function u(s){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=s[0]&2?i["return"]:s[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,s[1])).done)return o;if(i=0,o)s=[s[0]&2,o.value];switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;i=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(s[0]===6&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}if(o[2])n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];i=0}finally{r=o=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};System.register(["./p-44199f6a.system.js","./p-52e66aad.system.js"],function(e){"use strict";var t,n;return{setters:[function(e){t=e.r},function(e){n=e.A}],execute:function(){var r=function(){function e(){}e.getElementConfiguration=function(e){return JSON.parse(e.dataset.ssFreedomField)};e.getObjectDataForFieldElement=function(e){var t=e.closest("[data-ss-freedom-object]");var n=JSON.parse(t.dataset.ssFreedomObject);return{class:n.class,id:n.id}};return e}();var i=function(){function e(e,t,r){var i=this;if(e===void 0){e=MutationObserver}if(t===void 0){t=document.documentElement}if(r===void 0){r=null}this.observer=new e(function(e){return i.observerCallback(e)});this.htmlElement=t;this.apiService=r||new n;this.getTinyMce()}e.getTinyMceConfigurations=function(){return window["NikRolls"].SsFreedom.configurations};e.prototype.observeDom=function(){var e=this;this.observer.observe(this.htmlElement,{attributes:true,childList:true,subtree:true});Array.from(this.htmlElement.querySelectorAll("[data-ss-freedom-field]")).forEach(function(t){return e.initialiseEditorIfNecessary(t)})};e.prototype.observerCallback=function(e){var t=this;e.forEach(function(e){return __awaiter(t,void 0,void 0,function(){var t=this;return __generator(this,function(n){switch(n.label){case 0:if(e.type==="attributes"&&e.attributeName==="data-ss-freedom-field"){this.initialiseEditorIfNecessary(e.target)}else if(e.type==="childList"){Array.from(e.addedNodes).forEach(function(e){if(e instanceof HTMLElement){var n=Array.from(e.querySelectorAll("[data-ss-freedom-field]"));if(e.dataset&&e.dataset.ssFreedomField){n.push(e)}n.forEach(function(e){return t.initialiseEditorIfNecessary(e)})}})}return[4,this.tinyMce];case 1:n.sent().editors.forEach(function(e){if(e.getBody()&&!document.body.contains(e.getBody())){e.destroy()}});return[2]}})})})};e.prototype.initialiseEditorIfNecessary=function(t){return __awaiter(this,void 0,void 0,function(){var n,i,o;return __generator(this,function(s){switch(s.label){case 0:if(!t.dataset.ssFreedomField)return[3,3];return[4,this.tinyMce];case 1:n=s.sent().editors.find(function(e){return e.getBody()===t});if(!!n)return[3,3];i=r.getElementConfiguration(t);o=e.getTinyMceConfigurations();if(!o[i.type])return[3,3];return[4,this.initialiseTinyMceConfiguration(i.type,t)];case 2:s.sent();s.label=3;case 3:return[2]}})})};e.prototype.initialiseTinyMceConfiguration=function(t,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,s;var a=this;return __generator(this,function(u){switch(u.label){case 0:r=e.getTinyMceConfigurations();i=[];o=Object.assign({},r["all"],r[t],{target:n,setup:function(e){return i.forEach(function(t){return t(e)})},init_instance_callback:function(t){t.on("Change",function(e){return a.onChange(e)});e.updateEmptyFlag(t)}});if(o.class_selection_options){s=o.class_selection_options;delete o.class_selection_options;i.push(function(e){return a.createTinyMceOptionsMenu(e,s)})}if(n instanceof HTMLButtonElement){i.push(function(e){n.addEventListener("click",function(e){return e.preventDefault()});n.addEventListener("keydown",function(t){if(t.code==="Space"){t.preventDefault();e.insertContent(" ")}})})}return[4,this.tinyMce];case 1:return[2,u.sent().init(o)]}})})};e.prototype.getTinyMce=function(){this.tinyMce=new Promise(function(e){var t=window.setInterval(function(){if(window.tinymce){window.clearInterval(t);e(window.tinymce)}})})};e.prototype.onChange=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:e.updateEmptyFlag(t.target);return[4,this.updateCmsWithLatestData(t.target)];case 1:n.sent();return[2]}})})};e.prototype.createTinyMceOptionsMenu=function(e,t){e.ui.registry.addMenuButton("classselectionoptions",{text:"Options",fetch:function(n){var r=t.reduce(function(t,n){var r=e.selection.getNode();var i=r.closest(n.selector);var o=e.getBody().contains(i);if(i&&o){t.push({type:"nestedmenuitem",text:n.name,getSubmenuItems:function(){var e=n.classes;var t=Object.keys(e);var r=Object.values(e).filter(function(e){return!!e});var o=t.find(function(t){return e[t]===null});var s=t.find(function(t){return i.classList.contains(e[t])})||o;return t.map(function(t){return{type:"menuitem",text:t,icon:t===s?"checkmark":undefined,onAction:function(){var n;(n=i.classList).remove.apply(n,r);if(e[t]){i.classList.add(e[t])}}}})}})}return t},[]);n(r)}})};e.updateEmptyFlag=function(e){var t=e.getBody();if(e.getContent().trim()){t.classList.remove("ss-freedom-empty")}else{t.classList.add("ss-freedom-empty")}};e.prototype.updateCmsWithLatestData=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(i){switch(i.label){case 0:t=r.getObjectDataForFieldElement(e.getBody());n={};n[r.getElementConfiguration(e.getBody()).name]=e.getContent();return[4,this.apiService.updateObject(t.class,t.id,n)];case 1:return[2,i.sent()]}})})};return e}();var o=function(){function e(e){this.elementHovered=false;this.popupHovered=false;this.element=e;this.elementOverHandler=this.elementOverHandler.bind(this);this.elementLeaveHandler=this.elementLeaveHandler.bind(this);this.popupOverHandler=this.popupOverHandler.bind(this);this.popupLeaveHandler=this.popupLeaveHandler.bind(this);this.handleUpdate=this.debounce(this.handleUpdate.bind(this),0);this.setup()}e.prototype.setup=function(){this.element.addEventListener("mouseover",this.elementOverHandler)};e.prototype.destroy=function(){this.element.removeEventListener("mouseover",this.elementOverHandler);this.removeHoverState()};e.prototype.elementOverHandler=function(){this.elementHovered=true;this.popupHovered=false;this.handleUpdate()};e.prototype.elementLeaveHandler=function(){this.elementHovered=false;this.handleUpdate()};e.prototype.popupOverHandler=function(){this.popupHovered=true;this.handleUpdate()};e.prototype.popupLeaveHandler=function(){this.popupHovered=false;this.handleUpdate()};e.prototype.handleUpdate=function(){var e=document.querySelector(["ss-freedom-object-options-button:hover","ss-freedom-object-options-panel:hover",".tox:hover"].join(","));if(e){this.popupHovered=true;e.addEventListener("mouseleave",this.popupLeaveHandler)}if((this.elementHovered||this.popupHovered)&&!this.optionsButton){this.activateHoverState()}else if(!(this.elementHovered||this.popupHovered)&&this.optionsButton){this.removeHoverState()}};e.prototype.debounce=function(e,t){var n;return function(){window.clearTimeout(n);n=window.setTimeout(e,t)}};e.prototype.activateHoverState=function(){var e=this.element.getBoundingClientRect();this.element.addEventListener("mouseleave",this.elementLeaveHandler);this.element.classList.add("ss-freedom-show-hidden-empty");var t=document.createElement("ss-freedom-object-options-button");this.configureObjectMetadata(t);t.style.position="absolute";t.style.top=e.top+window.scrollY+"px";t.style.right=document.body.clientWidth-e.right+window.scrollX+"px";document.body.appendChild(t);this.optionsButton=t};e.prototype.removeHoverState=function(){this.element.removeEventListener("mouseleave",this.elementLeaveHandler);this.element.classList.remove("ss-freedom-show-hidden-empty");if(this.optionsButton){this.optionsButton.removeEventListener("mouseover",this.popupOverHandler);this.optionsButton.removeEventListener("mouseleave",this.popupLeaveHandler);this.optionsButton.remove();delete this.optionsButton}};e.prototype.configureObjectMetadata=function(e){var t=r.getObjectDataForFieldElement(this.element);e.setAttribute("object-class",t.class);e.setAttribute("object-id",t.id)};return e}();var s=function(){function e(e,t){var n=this;if(e===void 0){e=MutationObserver}if(t===void 0){t=document.documentElement}this.observer=new e(function(e){return n.observerCallback(e)});this.htmlElement=t}e.prototype.observeDom=function(){var e=this;this.observer.observe(this.htmlElement,{attributes:true,childList:true,subtree:true});Array.from(this.htmlElement.querySelectorAll("[data-ss-freedom-object]")).forEach(function(t){return e.wireObjectOptionsIfNecessary(t)})};e.prototype.observerCallback=function(e){var t=this;e.forEach(function(e){if(e.type==="attributes"&&e.attributeName==="data-ss-freedom-object"){t.wireObjectOptionsIfNecessary(e.target)}else if(e.type==="childList"){Array.from(e.addedNodes).forEach(function(e){if(e instanceof HTMLElement){var n=Array.from(e.querySelectorAll("[data-ss-freedom-object]"));if(e.dataset&&e.dataset.ssFreedomObject){n.push(e)}n.forEach(function(e){return t.wireObjectOptionsIfNecessary(e)})}})}})};e.prototype.wireObjectOptionsIfNecessary=function(e){var t=JSON.parse(e.dataset.ssFreedomObject);if(t.hasOptions&&!e["ssFreedomObjectOptionsInstanceWrangler"]){e["ssFreedomObjectOptionsInstanceWrangler"]=new o(e)}else if(!t.hasOptions&&e["ssFreedomObjectOptionsInstanceWrangler"]){e["ssFreedomObjectOptionsInstanceWrangler"].destroy();delete e["ssFreedomObjectOptionsInstanceWrangler"]}};return e}();var a=function(){function e(e){t(this,e)}e.prototype.componentWillLoad=function(){(new i).observeDom();(new s).observeDom()};e.prototype.render=function(){return};return e}();e("ss_freedom_admin_widget",a)}}});