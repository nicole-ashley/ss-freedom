var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r["throw"](t))}catch(t){o(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})};var __generator=this&&this.__generator||function(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){n.label=a[1];break}if(a[0]===6&&n.label<o[1]){n.label=o[1];o=a;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(a);break}if(o[2])n.ops.pop();n.trys.pop();continue}a=e.call(t,n)}catch(t){a=[6,t];i=0}finally{r=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};System.register(["./p-7e09ea04.system.js"],function(t,e){"use strict";var n;return{setters:[function(t){n=t.d}],execute:function(){var e="api/ssfreedom";var r=function(){function t(t){if(t===void 0){t=fetch.bind(window)}this.fetch=t}t.prototype.getOptionsForm=function(t,e){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.fetch(this.apiUrlFor("get_options_form")+("?class="+t+"&id="+e),{method:"GET",credentials:"include"})];case 1:n=r.sent();return[4,n.text()];case 2:return[2,r.sent()]}})})};t.prototype.updateObject=function(t,e,n){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(i){switch(i.label){case 0:return[4,this.fetch(this.apiUrlFor("update_object"),{method:"PATCH",credentials:"include",body:JSON.stringify({class:t,id:e,data:n})})];case 1:r=i.sent();return[4,r.text()];case 2:return[2,i.sent()]}})})};t.prototype.apiUrlFor=function(t){return e+"/"+t};return t}();var i=function(){function t(){}t.getElementConfiguration=function(t){return JSON.parse(t.dataset.ssFreedomField)};t.getObjectDataForFieldElement=function(t){var e=t.closest("[data-ss-freedom-object]");var n=JSON.parse(e.dataset.ssFreedomObject);return{class:n.class,id:n.id}};return t}();var o=function(){function t(t,e,n){var i=this;if(t===void 0){t=MutationObserver}if(e===void 0){e=document.documentElement}if(n===void 0){n=null}this.observer=new t(function(t){return i.observerCallback(t)});this.htmlElement=e;this.apiService=n||new r;this.getTinyMce()}t.getTinyMceConfigurations=function(){return window["NikRolls"].SsFreedom.configurations};t.prototype.observeDom=function(){var t=this;this.observer.observe(this.htmlElement,{attributes:true,childList:true,subtree:true});Array.from(this.htmlElement.querySelectorAll("[data-ss-freedom-field]")).forEach(function(e){return t.initialiseEditorIfNecessary(e)})};t.prototype.observerCallback=function(t){var e=this;t.forEach(function(t){return __awaiter(e,void 0,void 0,function(){var e=this;return __generator(this,function(n){switch(n.label){case 0:if(t.type==="attributes"&&t.attributeName==="data-ss-freedom-field"){this.initialiseEditorIfNecessary(t.target)}else if(t.type==="childList"){Array.from(t.addedNodes).forEach(function(t){if(t instanceof HTMLElement){var n=Array.from(t.querySelectorAll("[data-ss-freedom-field]"));if(t.dataset&&t.dataset.ssFreedomField){n.push(t)}n.forEach(function(t){return e.initialiseEditorIfNecessary(t)})}})}return[4,this.tinyMce];case 1:n.sent().editors.forEach(function(t){if(t.getBody()&&!document.body.contains(t.getBody())){t.destroy()}});return[2]}})})})};t.prototype.initialiseEditorIfNecessary=function(e){return __awaiter(this,void 0,void 0,function(){var n,r,o;return __generator(this,function(a){switch(a.label){case 0:if(!e.dataset.ssFreedomField)return[3,3];return[4,this.tinyMce];case 1:n=a.sent().editors.find(function(t){return t.getBody()===e});if(!!n)return[3,3];r=i.getElementConfiguration(e);o=t.getTinyMceConfigurations();if(!o[r.type])return[3,3];return[4,this.initialiseTinyMceConfiguration(r.type,e)];case 2:a.sent();a.label=3;case 3:return[2]}})})};t.prototype.initialiseTinyMceConfiguration=function(e,n){return __awaiter(this,void 0,void 0,function(){var r,i,o,a;var s=this;return __generator(this,function(c){switch(c.label){case 0:r=t.getTinyMceConfigurations();i=[];o=Object.assign({},r["all"],r[e],{target:n,setup:function(t){return i.forEach(function(e){return e(t)})},init_instance_callback:function(e){e.on("Change",function(t){return s.onChange(t)});t.updateEmptyFlag(e)}});if(o.class_selection_options){a=o.class_selection_options;delete o.class_selection_options;i.push(function(t){return s.createTinyMceOptionsMenu(t,a)})}return[4,this.tinyMce];case 1:return[2,c.sent().init(o)]}})})};t.prototype.getTinyMce=function(){this.tinyMce=new Promise(function(t){var e=window.setInterval(function(){if(window.tinymce){window.clearInterval(e);t(window.tinymce)}})})};t.prototype.onChange=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:t.updateEmptyFlag(e.target);return[4,this.updateCmsWithLatestData(e.target)];case 1:n.sent();return[2]}})})};t.prototype.createTinyMceOptionsMenu=function(t,e){t.ui.registry.addMenuButton("classselectionoptions",{text:"Options",fetch:function(n){var r=e.reduce(function(e,n){var r=t.selection.getNode();var i=r.closest(n.selector);var o=t.getBody().contains(i);if(i&&o){e.push({type:"nestedmenuitem",text:n.name,getSubmenuItems:function(){var t=n.classes;var e=Object.keys(t);var r=Object.values(t).filter(function(t){return!!t});var o=e.find(function(e){return t[e]===null});var a=e.find(function(e){return i.classList.contains(t[e])})||o;return e.map(function(e){return{type:"menuitem",text:e,icon:e===a?"checkmark":undefined,onAction:function(){var n;(n=i.classList).remove.apply(n,r);if(t[e]){i.classList.add(t[e])}}}})}})}return e},[]);n(r)}})};t.updateEmptyFlag=function(t){var e=t.getBody();if(t.getContent().trim()){e.classList.remove("ss-freedom-empty")}else{e.classList.add("ss-freedom-empty")}};t.prototype.updateCmsWithLatestData=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(r){switch(r.label){case 0:e=i.getObjectDataForFieldElement(t.getBody());n={};n[i.getElementConfiguration(t.getBody()).name]=t.getContent();return[4,this.apiService.updateObject(e.class,e.id,n)];case 1:return[2,r.sent()]}})})};return t}();var a=function(){function t(t){n(this,t)}t.prototype.componentWillLoad=function(){(new o).observeDom()};t.prototype.render=function(){return};return t}();t("ss_freedom_admin_widget",a)}}});